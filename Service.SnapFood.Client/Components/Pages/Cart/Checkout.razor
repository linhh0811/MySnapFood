@page "/checkout"
@inherits CheckoutBase
@using Service.SnapFood.Client.Dto.Cart
@using Microsoft.FluentUI.AspNetCore.Components

<h3>Thanh toán</h3>

@if (Cart == null || (!Cart.CartProductItems.Any() && !Cart.CartComboItems.Any()))
{
    <p>Giỏ hàng của bạn trống.</p>
    <FluentButton Appearance="Appearance.Accent" @onclick="NavigateToHome">Quay lại mua sắm</FluentButton>
}
else
{
    <div class="row">
        <div class="col-7">
            <FluentCard>
                <h4>CHI TIẾT ĐƠN HÀNG</h4>
                @foreach (var item in CartItems)
                {
                    if (item is CartProductItemDto product)
                    {
                        var price = product.Price;
                        var quantity = product.Quantity;
                        var subtotal = price * quantity;

                        <div class="row align-items-center border-bottom pb-2">
                            <div class="col-2">
                                <img src="@product.ImageUrl" class="img-fluid rounded" />
                            </div>
                            <div class="col-10">
                                <p class="my-1 fw-bold">@product.ProductName</p>
                                <p class="my-2 text-muted">x @product.Quantity <span class="float-end fw-bold">@subtotal.ToString("N0") đ</span></p>
                            </div>
                        </div>
                    }
                    else if (item is CartComboItemDto combo)
                    {
                        var price = combo.Price;
                        var quantity = combo.Quantity;
                        var subtotal = price * quantity;
                        <div class="row align-items-center border-bottom pb-2">
                            <div class="col-2">
                                <img src="@combo.ImageUrl" class="img-fluid rounded" />
                            </div>
                            <div class="col-10">
                                <p class="my-1 fw-bold">@combo.ComboName</p>
                                @foreach (var comboItem in combo.ComboProductItems)
                                {
                                    <p style="font-size:12px; margin:0px">@comboItem.Quantity @comboItem.ProductName</p>
                                }
                                <p class="my-2 text-muted">x @combo.Quantity <span class="float-end fw-bold">@subtotal.ToString("N0") đ</span></p>
                            </div>
                        </div>
                    }
                }
                <div class="mt-3">
                    <p class="d-flex justify-content-between my-2">
                        Tổng <span class="fw-bold">@Cart.TotalPrice.ToString("N0") đ</span>
                    </p>
                    <p class="d-flex justify-content-between my-2">
                        Khuyến mại <span class="fw-bold">0 đ</span>
                    </p>
                    <hr />
                    <p class="d-flex justify-content-between my-2">
                        Chi phí tạm tính <span class="fw-bold">@Cart.TotalPrice.ToString("N0") đ</span>
                    </p>
                    <p class="text-danger small">Đã bao gồm thuế VAT 8%</p>
                    <p class="d-flex justify-content-between mb-1">
                        Phí giao hàng <span class="fw-bold">10,000 đ</span>
                    </p>
                </div>
            </FluentCard>
        </div>
        <div class="col-5">
            <form @onsubmit="HandleCheckOut">
                <FluentCard>
                    <h4>Thông tin người nhận</h4>
                    @if (Address == null)
                    {
                        <div class="alert alert-info">
                            Địa chỉ của bạn trống.
                            <a href="/address">Thêm địa chỉ</a>
                        </div>
                    }
                    else
                    {
                        <p>@Address.FullName</p>
                        <p>@Address.NumberPhone</p>
                        <p>@Address.FullAddress</p>
                    }
                </FluentCard>
                <FluentCard>
                    <h4>Cửa hàng</h4>
                    <FluentSelect TOption="StoreDto" Items="@Stores" OptionText="@(x => x.StoreName)" @bind-SelectedOption="SelectedStore" />
                </FluentCard>
                <FluentCard>
                    <h4>THANH TOÁN</h4>
                    <div class="row mt-3 g-3">
                        <div class="col-md-4">
                            <label>
                                <input type="radio" name="payment" value="cash" checked @onchange="@(() => SetPaymentMethod("cash"))" />
                                <img src="https://cdn-icons-png.flaticon.com/512/2331/2331949.png" alt="Tiền mặt" width="50" />
                                <h6>Tiền mặt</h6>
                            </label>
                        </div>
                        <div class="col-md-4">
                            <label>
                                <input type="radio" name="payment" value="zalopay" checked @onchange="@(() => SetPaymentMethod("zalopay"))" />
                                <img src="https://www.lotteria.vn/grs-static/images/zalopay.svg" alt="ZaloPay" width="50" />
                                <h6>ZaloPay</h6>
                            </label>
                        </div>
                        <div class="col-md-4">
                            <label>
                                <input type="radio" name="payment" value="momo" checked @onchange="@(() => SetPaymentMethod("momo"))" />
                                <img src="https://upload.wikimedia.org/wikipedia/vi/f/fe/MoMo_Logo.png" alt="MoMo E-Wallet" width="50" />
                                <h6>MoMo E-Wallet</h6>
                            </label>
                        </div>
                    </div>
                </FluentCard>
                <FluentButton Type="ButtonType.Submit" Appearance="Appearance.Accent">Đặt hàng</FluentButton>
            </form>
        </div>
    </div>
}